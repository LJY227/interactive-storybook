<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡æ–°ç”Ÿæˆç¬¬ä¸€é¡µæ’ç”»</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .warning { background-color: #fff3cd; color: #856404; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .result-image {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .story-content {
            background: #f9f9f9;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .url-display {
            background: #e8f5e8;
            border: 1px solid #28a745;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ é‡æ–°ç”Ÿæˆç¬¬ä¸€é¡µæ’ç”»</h1>
        <p>ä½¿ç”¨LIBLIB AIçš„Text2ImageåŠŸèƒ½é‡æ–°ç”Ÿæˆã€Šå°ç†Šæ³¢æ³¢çš„å‹è°Šå†’é™©ã€‹ç¬¬ä¸€é¡µæ’ç”»ã€‚</p>
        
        <div class="story-content">
            <h3>ğŸ“– ç¬¬ä¸€é¡µæ•…äº‹å†…å®¹</h3>
            <p><strong>æ³¢æ³¢æ˜¯ä¸€åªä½åœ¨æ£®æ—é‡Œçš„å°æ£•ç†Šã€‚ä»–æœ‰ä¸€åŒå¥½å¥‡çš„å¤§çœ¼ç›å’Œä¸€é¢—å–„è‰¯çš„å¿ƒã€‚æ¯å¤©æ—©æ™¨ï¼Œæ³¢æ³¢éƒ½ä¼šååœ¨è‡ªå·±çš„å°æœ¨å±‹å‰ï¼Œæœ›ç€è¿œå¤„çš„å¤§æ ‘å’ŒèŠ±æœµï¼Œä½†ä»–ä»æ¥ä¸æ•¢èµ°å¾—å¤ªè¿œã€‚</strong></p>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button id="regenerateBtn" onclick="regeneratePage1()">ğŸ¨ é‡æ–°ç”Ÿæˆç¬¬ä¸€é¡µæ’ç”»</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div id="status"></div>
        <div id="log" class="log" style="display: none;"></div>
        <div id="result"></div>
    </div>

    <script type="module">
        // ç¬¬ä¸€é¡µçš„æ•…äº‹å†…å®¹
        const PAGE_1_CONTENT = "æ³¢æ³¢æ˜¯ä¸€åªä½åœ¨æ£®æ—é‡Œçš„å°æ£•ç†Šã€‚ä»–æœ‰ä¸€åŒå¥½å¥‡çš„å¤§çœ¼ç›å’Œä¸€é¢—å–„è‰¯çš„å¿ƒã€‚æ¯å¤©æ—©æ™¨ï¼Œæ³¢æ³¢éƒ½ä¼šååœ¨è‡ªå·±çš„å°æœ¨å±‹å‰ï¼Œæœ›ç€è¿œå¤„çš„å¤§æ ‘å’ŒèŠ±æœµï¼Œä½†ä»–ä»æ¥ä¸æ•¢èµ°å¾—å¤ªè¿œã€‚";

        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.style.display = 'block';
            logDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }

        // æ¸…é™¤ç»“æœ
        window.clearResults = function() {
            document.getElementById('result').innerHTML = '';
            document.getElementById('log').innerHTML = '';
            document.getElementById('log').style.display = 'none';
            showStatus('ç»“æœå·²æ¸…é™¤', 'info');
        };

        // æ„å»ºç¬¬ä¸€é¡µä¸“ç”¨æç¤ºè¯
        function buildPage1Prompt() {
            return "a cute brown bear named Bobo with big curious eyes, round face, small black nose, warm brown fur, kind and gentle expression, sitting in front of a small wooden house in the forest, looking at distant trees and flowers, morning sunlight filtering through leaves, children's watercolor illustration style, warm and friendly colors, soft gentle tones, clear outlines, designed for children aged 6-8, cozy and peaceful atmosphere, warm browns and greens, beautiful wildflowers, tall forest trees, peaceful morning scene, slightly shy but curious mood, high quality children's book illustration";
        }

        // é‡æ–°ç”Ÿæˆç¬¬ä¸€é¡µæ’ç”»
        window.regeneratePage1 = async function() {
            const btn = document.getElementById('regenerateBtn');
            btn.disabled = true;
            btn.textContent = 'â³ æ­£åœ¨é‡æ–°ç”Ÿæˆ...';
            
            try {
                log('ğŸ¨ å¼€å§‹é‡æ–°ç”Ÿæˆç¬¬ä¸€é¡µæ’ç”»');
                showStatus('æ­£åœ¨åˆå§‹åŒ–...', 'info');
                
                // å¯¼å…¥liblibService
                log('ğŸ“¦ å¯¼å…¥liblibServiceæ¨¡å—');
                const { default: liblibService } = await import('/src/services/liblibService.js');
                log('âœ… æ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                // åˆå§‹åŒ–APIå¯†é’¥
                log('ğŸ”‘ åˆå§‹åŒ–APIå¯†é’¥');
                const accessKey = 'VXlp-nUZOKSUC0bMSUqA_w';
                const secretKey = 'vyJel3b6lcZPTmcybbZpQ2jdhvsWXQch';
                
                liblibService.initializeApiKeys(accessKey, secretKey);
                log('âœ… APIå¯†é’¥åˆå§‹åŒ–æˆåŠŸ');
                
                // æ£€æŸ¥APIçŠ¶æ€
                const apiStatus = liblibService.getApiStatus();
                log('ğŸ” APIçŠ¶æ€æ£€æŸ¥å®Œæˆ');
                log('   - å·²åˆå§‹åŒ–: ' + apiStatus.isInitialized);
                log('   - åŸºç¡€URL: ' + apiStatus.baseUrl);
                log('   - æ¨¡æ¿UUID: ' + apiStatus.templateUuid);
                
                if (!apiStatus.isInitialized) {
                    throw new Error('APIå¯†é’¥åˆå§‹åŒ–å¤±è´¥');
                }
                
                showStatus('å¼€å§‹ç”Ÿæˆç¬¬ä¸€é¡µæ’ç”»...', 'warning');
                
                // æ„å»ºæç¤ºè¯
                const prompt = buildPage1Prompt();
                log('ğŸ”¤ ç¬¬ä¸€é¡µä¸“ç”¨æç¤ºè¯: ' + prompt);
                log('ğŸ“ æç¤ºè¯é•¿åº¦: ' + prompt.length + ' å­—ç¬¦');
                
                showStatus('æ­£åœ¨è¿›è¡ŒText2Imageç”Ÿæˆï¼Œé¢„è®¡éœ€è¦1-2åˆ†é’Ÿ...', 'warning');
                
                const startTime = Date.now();
                log('â³ å¼€å§‹è°ƒç”¨Text2Image API');
                log('ğŸ¯ ä½¿ç”¨å‚æ•°: aspectRatio="square", imgCount=1, steps=30');
                
                // ä½¿ç”¨Text2ImageåŠŸèƒ½ç”Ÿæˆå›¾ç‰‡
                const imageUrl = await liblibService.generateImage(prompt, '6-8å²');
                
                const endTime = Date.now();
                const duration = Math.round((endTime - startTime) / 1000);
                
                log('ğŸ‰ ç¬¬ä¸€é¡µæ’ç”»é‡æ–°ç”ŸæˆæˆåŠŸï¼');
                log('ğŸ”— å›¾ç‰‡URL: ' + imageUrl);
                log('â±ï¸ ç”Ÿæˆè€—æ—¶: ' + duration + ' ç§’');
                
                // æ˜¾ç¤ºç»“æœ
                showStatus('ç¬¬ä¸€é¡µæ’ç”»é‡æ–°ç”ŸæˆæˆåŠŸï¼', 'success');
                
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <h3>ğŸ‰ ç¬¬ä¸€é¡µæ’ç”»é‡æ–°ç”ŸæˆæˆåŠŸ</h3>
                    
                    <div class="url-display">
                        <h4>ğŸ”— æ–°ç”Ÿæˆçš„å›¾ç‰‡URL</h4>
                        <p><strong>${imageUrl}</strong></p>
                        <button onclick="navigator.clipboard.writeText('${imageUrl}')" style="font-size: 12px; padding: 5px 10px;">ğŸ“‹ å¤åˆ¶URL</button>
                        <a href="${imageUrl}" target="_blank" style="margin-left: 10px; font-size: 12px;">ğŸ”— åœ¨æ–°çª—å£æ‰“å¼€</a>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h4>ğŸ–¼ï¸ æ’ç”»é¢„è§ˆ</h4>
                        <img src="${imageUrl}" alt="ç¬¬ä¸€é¡µæ’ç”»" class="result-image" onload="console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ')" onerror="console.error('å›¾ç‰‡åŠ è½½å¤±è´¥')">
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 15px 0;">
                        <h4>ğŸ“Š ç”Ÿæˆä¿¡æ¯</h4>
                        <p><strong>åŠŸèƒ½:</strong> Text2Image (æ–‡ç”Ÿå›¾)</p>
                        <p><strong>ç”Ÿæˆè€—æ—¶:</strong> ${duration} ç§’</p>
                        <p><strong>ç”Ÿæˆæ—¶é—´:</strong> ${new Date().toLocaleString()}</p>
                        <p><strong>å›¾ç‰‡å°ºå¯¸:</strong> 1024x1024 (square)</p>
                        <p><strong>æœåŠ¡:</strong> LIBLIB AI</p>
                    </div>
                    
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 4px; margin: 15px 0; border: 1px solid #28a745;">
                        <h4>ğŸ“ æ›´æ–°storyData.tsçš„ä»£ç </h4>
                        <p>å°†ç¬¬1é¡µçš„imageå­—æ®µæ›´æ–°ä¸º:</p>
                        <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto;">image: "${imageUrl}"</pre>
                        
                        <p>æˆ–è€…å®Œæ•´çš„é¡µé¢å¯¹è±¡:</p>
                        <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto;">{
  id: 1,
  content: "${PAGE_1_CONTENT}",
  isInteractive: false,
  image: "${imageUrl}"
}</pre>
                    </div>
                `;
                
                // ä¿å­˜ç»“æœåˆ°localStorage
                const result = {
                    pageId: 1,
                    content: PAGE_1_CONTENT,
                    prompt: prompt,
                    imageUrl: imageUrl,
                    generatedAt: new Date().toISOString(),
                    duration: duration,
                    service: 'LIBLIB AI Text2Image',
                    parameters: {
                        aspectRatio: 'square',
                        imgCount: 1,
                        steps: 30
                    }
                };
                
                localStorage.setItem('page1_regenerated_result', JSON.stringify(result));
                log('ğŸ’¾ ç»“æœå·²ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨');
                log('ğŸ‰ ç¬¬ä¸€é¡µæ’ç”»é‡æ–°ç”Ÿæˆå®Œæˆï¼');
                
            } catch (error) {
                log('âŒ ç¬¬ä¸€é¡µæ’ç”»é‡æ–°ç”Ÿæˆå¤±è´¥: ' + error.message);
                console.error('è¯¦ç»†é”™è¯¯:', error);
                showStatus('é‡æ–°ç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ¨ é‡æ–°ç”Ÿæˆç¬¬ä¸€é¡µæ’ç”»';
            }
        };
    </script>
</body>
</html>
